<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Cellular Automata</title>
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    div {
      display: block;
      width: 1%;
      height: 1%;
      background: #ddd;
      float: left;
    }
  </style>

</head>

<body>
  <script>
    function random(min, max) {
      return Math.floor(Math.random() * (max - min + 1));
    }

    function createRow(seed) {
      var frag = document.createDocumentFragment();
      seed.forEach(state => {
        var div = document.createElement('div');
        div.style.backgroundColor = (state ? active : inactive);
        frag.appendChild(div);
      });
      document.body.appendChild(frag);
    };

    function applyRule(v, i, a) {
      var l = a[i - 1] || 0;
      var r = a[i + 1] || 0;

      return (rule.indexOf('' + l + v + r) > -1) | 0;
    };

    var hue = random(0, 180);
    var active = 'hsla(' + hue + ', 80%, 50%, .8)';
    var inactive = 'hsla(' + (hue + 180) + ', 80%, 50%, .8)';

    var seed = Array.apply(null, Array(100))
      .map(Number.prototype.valueOf, 0)
      .map(function() {
        return random(0, 1);
      });

    var rule = [0, 1, 2, 3, 4, 5, 6, 7]
      .filter(function(v) {
        return random(0, 1);
      })
      .map(function(v) {
        return ('000' + v.toString(2)).slice(-3);
      });

    createRow(seed);
    for (var i = 0; i < 100; i++) {
      seed = seed.map(applyRule);
      createRow(seed);
    }
  </script>
</body>

</html>
